# knowledge-graph-search

This is a single-page app providing a simple way to query the GovGraph
without having to use Cypher.


# Running

- clone this repository on a server
- install the govuk design system with `npm install` (needs NodeJS installed)
- create a file called `params.json` which looks like this:

```
{
  "server": "bolt+s://...",
  "user": "...",
  "password": "..."
}
```

- run a static webserver that will serve the files, with `index.html` as the default


# Deploying

Just copy all the files to a server. If you're hosting on PaaS and use Google Tag Manager
you can run the `deploy-to-paas.sh` script which will prompt for the GTM Id, will insert
the code snippets and push to PaaS

# Developing

## Files

- `index.html`: the base HTML, which sets the style but contains very little of the application itself, as the rest is generated by JS

- `js/*`:  the main application code. See below.

- `main.scss`: sass file, that compiles to `main.css` with `sass main.scss > main.css`

- `package.json`: used to retrieve the Government Design System assets

- `assets`: fonts and images

## Process

As above: run a local http server, connect to the govgraph endpoint, and reload as you make changes. Regenerate `main.css` when you change `main.scss`.

## Architecture

The application uses the [Elm Architecture](https://elmprogramming.com/elm-architecture-intro.html) model. The whole application state is held in a variable called `state`, and a function called `view` renders the HTML that corresponds to the current value of `state`, and sets event handlers on that HTML. Whenever an event happens (user clicks something, or a search returns) the `handleEvent` function updates the state accordingly and runs `view` again. This forms the main interaction loop. For instance:

- The user enters search terms and clicks "search"
- The DOM event handler runs `handleEvent`, which:
  - retrieves the new search terms from the form
  - and updates `state.keywords` with the new values
  - runs the search in neo4j
  - runs `view`
- The page shows the "searching screens" and waits for the next event
- Neo4j finishes searching and calls `handleEvent`, which updates `state` with the search results
- `handleEvent` calls `view`
- `view` renders the state, including the search results.
- The page waits for the next event
etc.
